var sub_pendientes=pila_vacia()
var etq_final

etiquetado(prog(decs,intrs)):
	$.prim=etq_final
	recolecta_subs(decs)
	etiquetado(intrs)
	etq_final++
	while Â¬ es-vacia(sub_pendientes)
		sub=cima(sub_pendientes)
		desapila(sub_pendientes)
		let sub= dec_proc(id,pforms,prog) in
			sub.prim=etq_final
			etq_final++
			recolecta_subs(pforms)
			etiquetado(prog)
			etq_final+=2
			sub.sig=etq_final
		end let
	end while
	$.sig=etq_final

recolecta-subs(si_decs(decs)):
	recolecta-subs(decs)

recolecta-subs(no_decs()):
	noop

recolecta-subs(mas_decs(decs, dec)):
	recolecta-subs(decs)
	recolecta-subs(dec)

etiquetado(mas_decs(decs,dec)):
	$.prim=etq_final
	etiquetado(decs)
	etiquetado(dec)
	$.sig=etq_final

recolecta-subs(una_dec(dec)):
	recolecta-subs(dec)

etiquetado(una_dec(dec)):
	$.prim=etq_final
	etiquetado(dec)
	$.sig=etq_final

recolecta-subs(dec_var(tipo, id)):
	noop

recolecta-subs(dec_tipo(tipo, id)):
	noop

recolecta-subs(dec_proc(id, pforms, prog)):
	apila(sub_pendientes, $)


etiquetado(dec_proc(id, pforms, prog)):
	$.prim=etq_final
	etiquetado(pform)
	etq_final+=2
	recolecta_subs(prog)

etiquetado(si_pforms(pforms)):
	etiquetado(pforms)

etiquetado(no_pforms()):
	noop

etiquetado(mas_pforms(pforms,pform))
	$.prim=etq_final
	etiquetado(pforms)
	etiquetado(pform)
	$.sig=etq_final

etiquetado(una_pform(pform)):
	$.prim=etq_final
	etiquetado(pform)
	$.sig=etq_final


etiquetado(t_iden(id)):
	$.prim=etq_final
	etiquetado-acc-id(id.vinculo)
	$.sig=etq_final


etiquetado(mas_cmp_s(camposs,campos)):
	$.prim=etq_final
	etiquetado(camposs)
	etiquetado(campos)
	$.sig=etq_final

etiquetado(un_cmp_s(campos)):
	$.prim=etq_final
	etiquetado(campos)
	$.sig=etq_final

//cmp_s(tipo, id)

etiquetado(si_intrs(intrs)):
	etiquetado(intrs)

etiquetado(no_intrs()):
	noop

etiquetado(mas_intrs(intrs,intr)):
	$.prim=etq_final
	etiquetado(intrs)
	etiquetado(intr)
	$.sig=etq_final

etiquetado(una_intr(intr)):
	$.prim=etq_final
	etiquetado(intr)
	$.sig=etq_final

etiquetado(i_eval(exp)):
	$.prim=etq_final
	if es-designador(exp) then
		etq_final++
	end if
	$.sig=etq_final

etiquetado(i_if(exp,prog,i_else)):
	$.prim=etq_final
	etiquetado(exp)
	if es-designador(exp) then
		etq_final++
	end if
	etiquetado(prog)
	etq_final++
	etiquetado(i_else)
	etq_final++
	$.sig=etq_final

etiquetado(i_while(exp,prog)):
	$.prim=etq_final
	etiquetado(exp)
	if es-designador(exp) then
		etq_final++
	end if
	etiquetado(prog)
	etq_final++
	$.sig=etq_final

etiquetado(i_read(exp)):
	$.prim = etq_final
	etiquetado(exp)
	etq_final++
	$.sig=etq_final

etiquetado(i_write(exp)):
	$.prim = etq_final
	etiquetado(exp)
	etq_final++
	$.sig=etq_final

etiquetado(i_nl()):
	$.prim = etq_final
	etq_final++
	$.sig=etq_final

etiquetado(i_new(exp)):
	$.prim = etq_final
	etiquetado(exp)
	etq_final++
	$.sig=etq_final

etiquetado(i_delete(exp)):
	$.prim = etq_final
	etiquetado(exp)
	etq_final++
	$.sig=etq_final

etiquetado(i_call(id, preals)):
	$.prim = etq_final
	etq_final++
	for preal in preals
		etiquetado_paso_param(&.vinculo, preal)
	etq_final++
	$.sig=etq_final

etiquetado(i_prog(prog)):
	$.prim = etq_final
	etiquetado(prog)
	etq_final++
	$.sig=etq_final

etiquetado(si_else(prog)):
	etiquetado(prog)

etiquetado(no_else()):
	noop
	
etiquetado(si_preals(preals)):
	etiquetado(preals)

etiquetado(no_preals()):
	noop

etiquetado(mas_preals(preals,exp)):
	$.prim=etq_final
	etiquetado(preals)
	etiquetado(exp)
	$.sig=etq_final

etiquetado(un_preals(exp)):
	$.prim = etq_final
	etiquetado(exp)
	etq_final++
	$.sig=etq_final

etiquetado(e_asig(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado(opnd0)
	etiquetado(opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_comp(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_dist(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_lt(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_gt(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_leq(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_geq(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_suma(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_resta(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_and(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_or(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_mul(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_div(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_porcentaje(opnd0, opnd1)):
	$.prim=etq_final
	etiquetado-operands(opnd0, opnd1)
	etq_final++
	$.sig=etq_final

etiquetado(e_negativo(opnd)):
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(e_negado(opnd)):
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(e_campo(opnd, id)):
	$.prim = etq_final
	etiquetado(opnd)
	etq_final+=2
	$.sig=etq_final
	
etiquetado(e_puntero(opnd)):
	$.prim = etq_final
	etiquetado(opnd)
	etq_final++
	$.sig=etq_final

etiquetado(e_indexado(opnd0, opnd1)):
	$.prim =etq_final
	etiquetado(opnd0)
	etiquetado(opnd1)
	if es-designador(exp) then
		etq_final++
	end if
	etq_final+=3
	$.sig=etq_final

etiquetado(e_lit_ent(num))
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(e_lit_real(num))
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(e_true()):
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(e_false()):
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(e_string(string)):
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(e_iden(id)):
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

etiquetado(_null()):
	$.prim=etq_final
	etq_final++
	$.sig=etq_final

//Funciones auxiliares

etiquetado-acc-id(dec_var(tipo, id)):
	if $.nivel=0 then
		etq_final++
	else
		etq_final+= 3
	end if

etiquetado_paso_param(proc(id, pforms, prog), preal):
	etq_final+= 3
	etiquetado(preal)
	etq_final++
